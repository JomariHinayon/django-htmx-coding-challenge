{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="container m-auto">
    <div class="w-full flex flex-col justify-center items-center">
        <h1 id="edit_profile_header" class="mt-10 text-xl">Welcome back, {{ user.full_name }}!</h1>
        <div class="mt-3 flex flex-col w-2/5 bg-white border border-gray-200 shadow-sm rounded-xl p-4 md:p-5 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400">
            <form
                id="edit_profile_form"
                hx-post="{% url 'home' %}"
                hx-trigger="submit"
                hx-swap="multi:#edit_profile_form:outerHTML,#edit_profile_header:innerHTML,#account_full_name:outerHTML"
                hx-ext="multi"
            >
                {% csrf_token %}
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Email</label>
                    <input
                        type="email"
                        id="email"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600"
                        value="{{ user.email }}"
                        disabled
                    >
                </div>
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">First Name</label>
                    <input
                        type="text"
                        id="first_name"
                        name="first_name"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none"
                        value="{{ form.first_name.value }}"
                        required
                    >
                </div>
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Last Name</label>
                    <input
                        type="text"
                        id="last_name"
                        name="last_name"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none"
                        value="{{ form.last_name.value }}"
                        required
                    >
                </div>
                <div class="mt-3 max-w">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Occupation</label>
                    <input
                        type="text"
                        id="occupation"
                        name="occupation"
                        class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-primary focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none"
                        value="{{ form.occupation.value }}"
                        required
                    >
                </div>
                <div class="flex justify-center">
                    <button
                        type="submit"
                        class="mt-5 m-auto py-3 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-primary text-white hover:bg-primary-700 focus:outline-none focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"
                    >
                        Update Profile
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% comment %} Invitation button {% endcomment %}
    <div class="flex items-center justify-center m-5">
        <button class="py-2 px-6 bg-blue-500 text-white rounded hover:bg-blue-700 transition font-medium duration-500" onclick="toggleModal()">Invite User </button>
      </div>
      <div class="fixed z-10 overflow-y-auto top-0 w-full left-0 hidden" id="modal">
        <div class="flex items-center justify-center min-height-100vh pt-4 px-4 pb-20 text-center sm:block sm:p-0">
          <div class="fixed inset-0 transition-opacity">
            <div class="absolute inset-0 bg-gray-900 opacity-75" />
          </div>
          <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>
          <div class="inline-block align-center bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full" role="dialog" aria-modal="true" aria-labelledby="modal-headline">
            
            <form
                id="invite_form"
                hx-post="{% url 'invite_user' %}"
                hx-trigger="submit"
                hx-swap="none"

            >
            {% csrf_token %}
                <div class="px-5 ">
                    <h1 id="edit_profile_header" class="mt-5 text-lg font-medium">Invite User</h1>
                    <p id="edit_profile_header" class="my-5 text-sm ">Enter the email address of the user you would like to invite.</p>
                </div>
                <div class="mt-3 max-w m-5">
                    <label for="input-label" class="block text-sm font-medium mb-2 dark:text-white">Email</label>
                     {{ invite_user_form.email }}
                </div>
                <div class="bg-gray-200 px-4 py-3 text-right">
                <button type="button" class="py-2 px-4 bg-gray-500 text-white rounded hover:bg-gray-700 mr-2" onclick="toggleModal()"><i class="fas fa-times"></i> Cancel</button>
                <button type="submit" class="py-2 px-4 bg-blue-500 text-white rounded font-medium hover:bg-blue-700 mr-2 transition duration-500" ><i class="fas fa-plus"></i> Invite user</button>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>
<div>

<script>
    // Add event listener for the 'show-toast' custom event
    document.addEventListener('show-toast', event => {
        const { level, message, title } = event.detail;
        toastr[level](message, title);
    });
    function toggleModal() { 
        document.getElementById('modal').classList.toggle('hidden')
    }

    document.addEventListener('htmx:afterRequest', function(event) {
        const response = JSON.parse(event.detail.xhr.response);
        if (response.success) {
            const header = document.getElementById('edit_profile_header');
            const account_full_name = document.getElementById('account_full_name');
            header.innerHTML = `Welcome back, ${response.user.full_name}!`;
            account_full_name.innerHTML = response.user.full_name;
        } else {
            // Optionally handle form errors here
            console.error('Form submission failed', response.errors);
        }
    });
</script>

{% endblock content %}